# FE-05 — Cross-object: sessionStorage и Nudge-модал

> Вынесено из [98-backlog.md](98-backlog.md).

---

## 1. Архитектурный анализ (CoT)
Реализуется на Frontend: использование sessionStorage для автозаполнения данных между переходами по помещениям; после сохранения первой анкеты — модальное окно (Nudge) с предложением выбрать другие помещения (машиноместо/кладовка). Архитектура не меняется; данные не уходят на сервер кроме явной отправки формы.

## 2. Описание и цель
Удержание пользователя и упрощение ввода: сохранение введённых данных в сессии и подсказка заполнить анкеты по другим помещениям того же собственника. Цель — повышение охвата и соответствие БТ [cite: 56, 57].

## 3. Функциональные требования
* **SR-FE05-001:** Система должна сохранять в sessionStorage все данные, введённые в форму (isOwner, phone, email, telegramId, barrierVote, voteFormat, registeredEd), для автозаполнения при переходе к другому помещению. Сохранение происходит при каждом изменении полей.
* **SR-FE05-002:** При открытии формы для нового помещения система должна подставлять из sessionStorage значения **всех** полей, включая phone/email/telegram, ранее введённых в этой сессии. Над формой отображается уведомление «Данные заполнены из предыдущей анкеты» с кнопкой «Очистить» для сброса всех полей.
* **SR-FE05-003:** После успешной отправки анкеты система должна показывать модальное окно (Nudge) с текстом о возможности указать другие помещения (машиноместо, кладовка).
* **SR-FE05-004:** Nudge должен содержать три кнопки: «Найти на карте» (переход на главную с шахматкой), «Выбрать из списка» (переход к каскадным фильтрам FE-03) и «Это всё» (закрыть модал).
* **SR-FE05-005:** Закрытие Nudge не должно блокировать дальнейшую работу; пользователь может снова выбрать помещение через карту или фильтры.
* **SR-FE05-006:** Кнопка «Очистить» должна сбрасывать все поля формы в начальное состояние и удалять данные из sessionStorage.

## 4. Сценарий использования
**Триггер:** Пользователь отправил анкету или перешёл к форме другого помещения.
**Main Success Scenario:**
1. После отправки анкеты показывается Nudge с тремя кнопками.
2. Пользователь нажимает «Найти на карте» → переход на главную (шахматка), или «Выбрать из списка» → переход к каскадным фильтрам.
3. Форма для нового помещения открывается с подставленными из sessionStorage данными (все поля, включая контакты). Над формой — уведомление с кнопкой «Очистить».
4. Пользователь при необходимости правит данные и отправляет.
**Alternative Flows:**
* **AF-1 (Пользователь нажал «Это всё»):** Модал закрывается, пользователь остаётся на странице с сообщением об успехе.
* **AF-2 (Пользователь нажал «Очистить»):** Все поля формы сбрасываются, sessionStorage очищается.
* **AF-3 (Закрытие вкладки):** sessionStorage очищается автоматически; при новом визите автозаполнения нет.

## 5. Модель данных
Не меняется на сервере. На клиенте — ключ `mkd_form_cache` в sessionStorage (JSON с полями формы), флаг `mkd_form_submitted`.

## 6. Интеграции и API
Нет новых API; поведение только на клиенте.

## 7. Нефункциональные требования
* **Security:** Данные хранятся в sessionStorage (очищается при закрытии вкладки). Допущение: sessionStorage используется как временный клиентский буфер; полные значения phone/email/telegram сохраняются для удобства автозаполнения, т.к. sessionStorage не доступен другим вкладкам/сайтам и очищается при закрытии.
* **Accessibility:** Nudge-модал имеет `role="dialog"`, `aria-modal="true"`, автофокус при открытии. Оверлей закрывает модал по клику.
