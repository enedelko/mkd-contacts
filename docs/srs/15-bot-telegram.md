# BOT-01‚Ä¶04 ‚Äî Telegram-–±–æ—Ç: –ø–æ–∏—Å–∫, –∞–Ω–∫–µ—Ç–∞, –õ–ö, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

> –ò–∑–≤–ª–µ—á–µ–Ω–æ –∏–∑ [98-backlog.md](98-backlog.md). –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: CORE-01, CORE-02, BE-02, BE-03.

**–ü—Ä–∏–Ω—è—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è:**
- –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –æ–¥–Ω–∏–º –ú–ö–î (–≤—ã–±–æ—Ä –¥–æ–º–∞ –Ω–µ –Ω—É–∂–µ–Ω).
- –ê–Ω–æ–Ω–∏–º–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –≤ –±–æ—Ç–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è; telegram_id –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ `message.from.id`.
- Email –≤ –±–æ—Ç–µ –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ–ª–µ—Ñ–æ–Ω (Share Contact) –∏/–∏–ª–∏ Telegram username.
- Rate limit: 10 submit/—á–∞—Å –Ω–∞ telegram_id (–∞–Ω–∞–ª–æ–≥ BE-04 –ø–æ IP, SR-BE04-006); –ø–ª—é—Å –ª–∏–º–∏—Ç 10 –Ω–µ–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–º–µ—â–µ–Ω–∏–µ (SR-CORE02-004).
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞—Ö–º–∞—Ç–∫–∏/–∫–∞—Ä—Ç—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è; –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–æ—Ç–∞ –≤–∏–¥–Ω—ã –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
- –°–µ—Å—Å–∏–∏ –±–æ—Ç–∞ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã (SQLite-—Ñ–∞–π–ª –Ω–∞ volume) ‚Äî –ø–µ—Ä–µ–∂–∏–≤–∞—é—Ç —Ä–µ—Å—Ç–∞—Ä—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
- Webhook (–Ω–µ long polling) ‚Äî HTTPS —É–∂–µ –µ—Å—Ç—å —á–µ—Ä–µ–∑ Nginx.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram    ‚îÇ         ‚îÇ        Docker Compose            ‚îÇ
‚îÇ  Cloud       ‚îÇ         ‚îÇ                                  ‚îÇ
‚îÇ  (webhook)   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  bot  (aiogram 3.x)              ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ    ‚îú‚îÄ FSM (—Å—Ç–µ–π—Ç-–º–∞—à–∏–Ω–∞)         ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ    ‚îú‚îÄ SQLite: /data/sessions.db  ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ    ‚îÇ  (volume: bot_data)         ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ    ‚îÇ                             ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ    ‚îî‚îÄ HTTP ‚Üí backend:8000        ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ                                  ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ  backend  (FastAPI, :8000)       ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ          ‚îÇ                       ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ          ‚ñº                       ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ  db      (PostgreSQL)            ‚îÇ
‚îÇ              ‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ              ‚îÇ
‚îÇ              ‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              ‚îÇ         ‚îÇ Nginx (—Ö–æ—Å—Ç) ‚îÇ
‚îÇ              ‚îÇ         ‚îÇ /api/tg-wh/* ‚îÇ‚îÄ‚îÄ‚ñ∂ bot:8443
‚îÇ              ‚îÇ         ‚îÇ /api/*       ‚îÇ‚îÄ‚îÄ‚ñ∂ backend:8000
‚îÇ              ‚îÇ         ‚îÇ /            ‚îÇ‚îÄ‚îÄ‚ñ∂ frontend:8080
‚îÇ              ‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü–æ–¥—Ö–æ–¥: –ë–æ—Ç ‚Üí Backend API (—Ç–æ–Ω–∫–∏–π –∫–ª–∏–µ–Ω—Ç).** –ë–æ—Ç ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ docker-compose, –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ `backend` –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏ Docker. –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–≤–∞–ª–∏–¥–∞—Ü–∏—è, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –∞—É–¥–∏—Ç, –ª–∏–º–∏—Ç—ã) ‚Äî –≤ Backend. –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ Telegram UI –∏ —Å—Ç–µ–π—Ç-–º–∞—à–∏–Ω—É –¥–∏–∞–ª–æ–≥–∞.

**–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∫ Backend:** –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Bot-Token` (shared secret, —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `.env`, –Ω–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏). Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–∫–µ–Ω –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö `/api/bot/*`.

**–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ü–∏—è —Å–µ—Å—Å–∏–π:** aiogram 3.x –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ storage –¥–ª—è FSM. –ò—Å–ø–æ–ª—å–∑—É–µ–º SQLite-—Ñ–∞–π–ª (`/data/sessions.db`), –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —á–µ—Ä–µ–∑ Docker volume `bot_data`. –ü—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –Ω–µ–∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å —Ç–æ–≥–æ –∂–µ —à–∞–≥–∞. TTL —Å–µ—Å—Å–∏–∏ ‚Äî 1 —á–∞—Å; –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ.

---

## –°—Ç–µ–π—Ç-–º–∞—à–∏–Ω–∞ –∏ CX

–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ **SQLite** (`/data/sessions.db`, Docker volume `bot_data`). TTL —Å–µ—Å—Å–∏–∏ ‚Äî 1 —á–∞—Å. –ö–∞–∂–¥–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç: `chat_id`, `state` (enum), `data` (JSON —Å –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏), `updated_at`. –ü—Ä–∏ `updated_at` —Å—Ç–∞—Ä—à–µ 1 —á–∞—Å–∞ ‚Äî –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ IDLE.

–ü–æ—Ç–æ–∫ —Å—Ç—Ä–æ–∏—Ç—Å—è –≤–æ–∫—Ä—É–≥ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞, –∞ –Ω–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è: —Å–Ω–∞—á–∞–ª–∞ —Å–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø–æ–º–µ—â–µ–Ω–∏—è, –ø–æ—Ç–æ–º –≤–æ–ø—Ä–æ—Å—ã (–æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –≤—Å–µ –ø–æ–º–µ—â–µ–Ω–∏—è), –≤ –∫–æ–Ω—Ü–µ ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –ø–æ–ª–∏—Ç–∏–∫–∞. –í–æ–ø—Ä–æ—Å—ã –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–µ–∫—É—â–∏–µ –æ—Ç–≤–µ—Ç—ã, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –æ–±—Ä–∞—â–∞–ª—Å—è —Ä–∞–Ω–µ–µ.

```
IDLE ‚Üí PREMISES_OVERVIEW ‚Üí ENTER_PREMISE ‚Üí [DISAMBIGUATE] ‚Üí CONFIRM_PREMISE
     ‚Üí OFFER_PARKING_STORAGE / OFFER_MORE ‚Üí VOTE_METHOD ‚Üí BARRIER_VOTE
     ‚Üí CONTACT_MANAGE ‚Üí [ENTER_PHONE] ‚Üí DONE
                      ‚Üí [CONFIRM_DELETE ‚Üí IDLE]
```

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

| –ö–æ–º–∞–Ω–¥–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `/start` | –ù–∞—á–∞–ª–æ: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + [–Ø —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫] |
| `/mydata` | –¢–æ –∂–µ, —á—Ç–æ /start (–≤—Ö–æ–¥ –≤ PREMISES_OVERVIEW) |
| `/cancel` | –°–±—Ä–æ—Å —Ç–µ–∫—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞ ‚Üí IDLE |
| `/help` | –ö—Ä–∞—Ç–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞ |

### –û–ø–∏—Å–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

* **IDLE**

```
–≠—Ç–æ—Ç –±–æ—Ç –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–±—Ä–∞—Ç—å –≥–æ–ª–æ—Å–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤
–¥–ª—è –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–≥–æ –û–±—â–µ–≥–æ —Å–æ–±—Ä–∞–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ –ú–ö–î ¬´[–∞–¥—Ä–µ—Å –¥–æ–º–∞]¬ª.

–ù–∞–º –≤–∞–∂–Ω–æ –ø–æ–Ω—è—Ç—å, –Ω–∞–±–∏—Ä–∞–µ—Ç—Å—è –ª–∏ –∫–≤–æ—Ä—É–º ‚Äî 2/3 –≥–æ–ª–æ—Å–æ–≤
–æ—Ç –æ–±—â–µ–π –ø–ª–æ—â–∞–¥–∏ –¥–æ–º–∞.

–ï—Å–ª–∏ –≤—ã —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫ –ø–æ–º–µ—â–µ–Ω–∏—è –≤ —ç—Ç–æ–º –¥–æ–º–µ ‚Äî –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ.
```

–ö–Ω–æ–ø–∫–∏: `[–Ø —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫]` `[–ú–æ–∏ –¥–∞–Ω–Ω—ã–µ]` `[–ü–æ–º–æ—â—å]`

- –ù–∞–∂–∞–ª `[–Ø —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫]` –∏–ª–∏ `/start` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **PREMISES_OVERVIEW**
- –ù–∞–∂–∞–ª `[–ú–æ–∏ –¥–∞–Ω–Ω—ã–µ]` –∏–ª–∏ `/mydata` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **PREMISES_OVERVIEW** (—Ç–æ—Ç –∂–µ —ç–∫—Ä–∞–Ω)
- –ù–∞–∂–∞–ª `[–ü–æ–º–æ—â—å]` –∏–ª–∏ `/help` ‚Äî —Å–ø—Ä–∞–≤–∫–∞, –æ—Å—Ç–∞—ë–º—Å—è –≤ **IDLE**
- –õ—é–±–æ–π —Ç–µ–∫—Å—Ç ‚Äî ¬´–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –∏–ª–∏ /start¬ª, –æ—Å—Ç–∞—ë–º—Å—è –≤ **IDLE**

---

* **PREMISES_OVERVIEW**

–î–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–ø–∏—Å–µ–π –Ω–µ—Ç):

```
–ü–æ–∫–∞ —É –Ω–∞—Å –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –≤–∞—à–∏—Ö –ø–æ–º–µ—â–µ–Ω–∏—è—Ö.

–ö–∞–∫–∞—è —É –≤–∞—Å –∫–≤–∞—Ä—Ç–∏—Ä–∞ –∏–ª–∏ –¥—Ä–æ–≥–æ–µ –ø–æ–º–µ—â–µ–Ω–∏–µ (–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã, –º–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ, –º–∞–≥–∞–∑–∏–Ω, –∫–ª–∞–¥–æ–≤–∫–∞)? –í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä: –∫–≤.945
```

–ö–Ω–æ–ø–∫–∏: `[–û—Ç–º–µ–Ω–∞]`

–î–ª—è –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–≥–æ—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∑–∞–ø–∏—Å–∏ –µ—Å—Ç—å):

```
–í–∞—à–∏ –ø–æ–º–µ—â–µ–Ω–∏—è:
  ‚Ä¢ –ö–≤–∞—Ä—Ç–∏—Ä–∞ 45
  ‚Ä¢ –ö–ª–∞–¥–æ–≤–∫–∞ 3

–•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–º–µ—â–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–æ–ø—Ä–æ—Å–∞–º?
```

–ö–Ω–æ–ø–∫–∏: `[–î–æ–±–∞–≤–∏—Ç—å –ø–æ–º–µ—â–µ–Ω–∏–µ]` `[–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤–æ–ø—Ä–æ—Å–∞–º ‚ûú]` `[–û—Ç–º–µ–Ω–∞]`


- –í–≤—ë–ª —Ç–µ–∫—Å—Ç (–Ω–æ–º–µ—Ä/–Ω–∞–∑–≤–∞–Ω–∏–µ) ‚Äî BOT-01 resolve:
  - 1 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONFIRM_PREMISE**
  - –±–æ–ª—å—à–µ 1 ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **DISAMBIGUATE**
  - 0 ‚Äî ¬´–ù–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑¬ª, –æ—Å—Ç–∞—ë–º—Å—è –≤ **PREMISES_OVERVIEW**
- –ù–∞–∂–∞–ª `[–î–æ–±–∞–≤–∏—Ç—å –ø–æ–º–µ—â–µ–Ω–∏–µ]` ‚Äî –±–æ—Ç: ¬´–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –ø–æ–º–µ—â–µ–Ω–∏—è¬ª, –æ—Å—Ç–∞—ë–º—Å—è –≤ **PREMISES_OVERVIEW** (—Ä–µ–∂–∏–º –≤–≤–æ–¥–∞)
- –ù–∞–∂–∞–ª `[–ü–µ—Ä–µ–π—Ç–∏ –∫ –≤–æ–ø—Ä–æ—Å–∞–º ‚ûú]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **VOTE_METHOD**
- –ù–∞–∂–∞–ª `[–û—Ç–º–µ–Ω–∞]` –∏–ª–∏ `/cancel` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

* **DISAMBIGUATE**

```
–ù–∞–π–¥–µ–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:
```

–ö–Ω–æ–ø–∫–∏: `[–ö–≤–∞—Ä—Ç–∏—Ä–∞ 45]` `[–ö–≤–∞—Ä—Ç–∏—Ä–∞ 450]` ... (–º–∞–∫—Å 5) + `[–í–≤–µ—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ]` `[–û—Ç–º–µ–Ω–∞]`

- –ù–∞–∂–∞–ª –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONFIRM_PREMISE**
- –ù–∞–∂–∞–ª `[–í–≤–µ—Å—Ç–∏ –∑–∞–Ω–æ–≤–æ]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **PREMISES_OVERVIEW**
- –ù–∞–∂–∞–ª `[–û—Ç–º–µ–Ω–∞]` –∏–ª–∏ `/cancel` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

* **CONFIRM_PREMISE**

```
–ö–≤–∞—Ä—Ç–∏—Ä–∞ 45 ‚Äî –≤–µ—Ä–Ω–æ?
```

–ö–Ω–æ–ø–∫–∏: `[–î–∞]` `[–ù–µ—Ç, –≤–≤–µ—Å—Ç–∏ –¥—Ä—É–≥–æ–µ]`

- –ù–∞–∂–∞–ª `[–î–∞]` ‚Äî –ø–æ–º–µ—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ —Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–∏:
  - –µ—Å–ª–∏ —Ç–∏–ø = –∫–≤–∞—Ä—Ç–∏—Ä–∞ –∏–ª–∏ –∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **OFFER_PARKING_STORAGE**
  - –µ—Å–ª–∏ —Ç–∏–ø = –∫–ª–∞–¥–æ–≤–∫–∞, –º–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ, –∏–Ω–æ–µ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **OFFER_MORE**
- –ù–∞–∂–∞–ª `[–ù–µ—Ç, –≤–≤–µ—Å—Ç–∏ –¥—Ä—É–≥–æ–µ]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **PREMISES_OVERVIEW**

---

* **OFFER_PARKING_STORAGE**

```
–í–∞—à–∏ –ø–æ–º–µ—â–µ–Ω–∏—è:
  ‚úì –ö–≤–∞—Ä—Ç–∏—Ä–∞ 45

–£ –≤–∞—Å –µ—Å—Ç—å –º–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ –∏–ª–∏ –∫–ª–∞–¥–æ–≤–∫–∞ –≤ —ç—Ç–æ–º –¥–æ–º–µ?
–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä, –Ω–∞–ø—Ä–∏–º–µ—Ä: –º–º 12, –∫–ª–∞–¥–æ–≤–∫–∞ 5
```

–ö–Ω–æ–ø–∫–∏: `[–ù–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚ûú]` `[–û—Ç–º–µ–Ω–∞]`

- –í–≤—ë–ª —Ç–µ–∫—Å—Ç ‚Äî BOT-01 resolve:
  - 1 —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONFIRM_PREMISE**
  - –±–æ–ª—å—à–µ 1 ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **DISAMBIGUATE**
  - 0 ‚Äî ¬´–ù–µ –Ω–∞–π–¥–µ–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑¬ª, –æ—Å—Ç–∞—ë–º—Å—è –≤ **OFFER_PARKING_STORAGE**
- –ù–∞–∂–∞–ª `[–ù–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚ûú]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **VOTE_METHOD**
- –ù–∞–∂–∞–ª `[–û—Ç–º–µ–Ω–∞]` –∏–ª–∏ `/cancel` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

* **OFFER_MORE**

```
–í–∞—à–∏ –ø–æ–º–µ—â–µ–Ω–∏—è:
  ‚úì –ö–≤–∞—Ä—Ç–∏—Ä–∞ 45
  ‚úì –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ 12

–•–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë –ø–æ–º–µ—â–µ–Ω–∏–µ?
–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å¬ª.
```

–ö–Ω–æ–ø–∫–∏: `[–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚ûú]` `[–û—Ç–º–µ–Ω–∞]`

- –í–≤—ë–ª —Ç–µ–∫—Å—Ç ‚Äî BOT-01 resolve (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ) ‚Üí **CONFIRM_PREMISE** / **DISAMBIGUATE**
- –ù–∞–∂–∞–ª `[–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å ‚ûú]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **VOTE_METHOD**
- –ù–∞–∂–∞–ª `[–û—Ç–º–µ–Ω–∞]` –∏–ª–∏ `/cancel` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

* **VOTE_METHOD**

–ï—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ:

```
–í–∞—à–∏ –ø–æ–º–µ—â–µ–Ω–∏—è:
  ‚úì –ö–≤–∞—Ä—Ç–∏—Ä–∞ 45
  ‚úì –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ 12

–ö–∞–∫ –≤—ã –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –Ω–∞ –û–°–°?

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ ¬´–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –î–æ–º¬ª (mos.ru/ed)
–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∏–¥–∏—Ç–µ —Ç–∞–º –≤—Å–µ —Å–≤–æ–∏ –ø–æ–º–µ—â–µ–Ω–∏—è.

–¢–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç: –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ ‚úé
```

–ö–Ω–æ–ø–∫–∏: `[–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ (–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –î–æ–º)]` `[–ù–∞ –±—É–º–∞–∂–Ω–æ–º –±—é–ª–ª–µ—Ç–µ–Ω–µ]` `[–ù–µ –±—É–¥—É –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å]` + `[–ù–∞–∑–∞–¥]` `[–û—Ç–º–µ–Ω–∞]`

–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç ‚Äî —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ —Å—Ç—Ä–æ–∫–∏ ¬´–¢–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç¬ª.

- –ù–∞–∂–∞–ª `[–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ]` ‚Äî vote_format=electronic, registered_in_ed=true, –ø–µ—Ä–µ—Ö–æ–¥ –≤ **BARRIER_VOTE**
- –ù–∞–∂–∞–ª `[–ù–∞ –±—É–º–∞–∂–Ω–æ–º –±—é–ª–ª–µ—Ç–µ–Ω–µ]` ‚Äî vote_format=paper, registered_in_ed=false, –ø–µ—Ä–µ—Ö–æ–¥ –≤ **BARRIER_VOTE**
- –ù–∞–∂–∞–ª `[–ù–µ –±—É–¥—É –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å]` ‚Äî vote_format=abstain, –ø–µ—Ä–µ—Ö–æ–¥ –≤ **BARRIER_VOTE**
- –ù–∞–∂–∞–ª `[–ù–∞–∑–∞–¥]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **OFFER_MORE** (–∏–ª–∏ **OFFER_PARKING_STORAGE**, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏)
- –ù–∞–∂–∞–ª `[–û—Ç–º–µ–Ω–∞]` –∏–ª–∏ `/cancel` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

* **BARRIER_VOTE**

```
–ì–æ—Ç–æ–≤—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Å—Ö–µ–º—É —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —à–ª–∞–≥–±–∞—É–º–æ–≤?

–¢–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç: –ó–∞ ‚úé
```

–ö–Ω–æ–ø–∫–∏: `[–ó–∞]` `[–ü—Ä–æ—Ç–∏–≤]` `[–ù–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª—Å—è]` + `[–ù–∞–∑–∞–¥]` `[–û—Ç–º–µ–Ω–∞]`

–ï—Å–ª–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–µ—Ç ‚Äî –±–µ–∑ —Å—Ç—Ä–æ–∫–∏ ¬´–¢–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç¬ª.

- –ù–∞–∂–∞–ª `[–ó–∞]` ‚Äî barrier_vote=for, –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONTACT_MANAGE**
- –ù–∞–∂–∞–ª `[–ü—Ä–æ—Ç–∏–≤]` ‚Äî barrier_vote=against, –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONTACT_MANAGE**
- –ù–∞–∂–∞–ª `[–ù–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª—Å—è]` ‚Äî barrier_vote=undecided, –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONTACT_MANAGE**
- –ù–∞–∂–∞–ª `[–ù–∞–∑–∞–¥]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **VOTE_METHOD**
- –ù–∞–∂–∞–ª `[–û—Ç–º–µ–Ω–∞]` –∏–ª–∏ `/cancel` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

* **CONTACT_MANAGE**

–ï—Å–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω —É–∂–µ –∏–∑–≤–µ—Å—Ç–µ–Ω:

```
–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏: +7 999 123-45-67

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–æ–º–µ—Ä. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏–ª–∏ —É–¥–∞–ª–∏—Ç–µ.

–û—Ç–ø—Ä–∞–≤–ª—è—è –¥–∞–Ω–Ω—ã–µ, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:
https://example.com/policy
```

–ö–Ω–æ–ø–∫–∏: `[–í—Å—ë –≤–µ—Ä–Ω–æ, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚úì]` `[–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω]` `[–£–¥–∞–ª–∏—Ç—å –º–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã]` + `[–ù–∞–∑–∞–¥]`

–ï—Å–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–µ—Ç:

```
–£ –Ω–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –≤–∞—à–µ–≥–æ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Å–≤—è–∑–∏.

–ü–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –≤—Ä—É—á–Ω—É—é.

–û—Ç–ø—Ä–∞–≤–ª—è—è –¥–∞–Ω–Ω—ã–µ, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:
https://example.com/policy
```

–ö–Ω–æ–ø–∫–∞ (ReplyKeyboard): `[üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º]`

- –ù–∞–∂–∞–ª `[–í—Å—ë –≤–µ—Ä–Ω–æ, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚úì]` ‚Äî POST/PATCH –Ω–∞ Backend ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –≤ **DONE**
- –ù–∞–∂–∞–ª `[–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **ENTER_PHONE**
- –ù–∞–∂–∞–ª `[–£–¥–∞–ª–∏—Ç—å –º–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONFIRM_DELETE**
- –ù–∞–∂–∞–ª `[üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º]` ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—É—á–µ–Ω ‚Üí –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ—Ç –∂–µ —ç–∫—Ä–∞–Ω —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º –∏ –∫–Ω–æ–ø–∫–æ–π `[–í—Å—ë –≤–µ—Ä–Ω–æ, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å ‚úì]`
- –í–≤—ë–ª –Ω–æ–º–µ—Ä –≤—Ä—É—á–Ω—É—é ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è:
  - –æ–∫ ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ—Ç –∂–µ —ç–∫—Ä–∞–Ω —Å –Ω–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º
  - –æ—à–∏–±–∫–∞ ‚Äî ¬´–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç¬ª, –æ—Å—Ç–∞—ë–º—Å—è –≤ **CONTACT_MANAGE**
- –ù–∞–∂–∞–ª `[–ù–∞–∑–∞–¥]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **BARRIER_VOTE**
- `/cancel` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

* **ENTER_PHONE**

```
–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ +7XXXXXXXXXX
–∏–ª–∏ –ø–æ–¥–µ–ª–∏—Ç–µ—Å—å –∫–æ–Ω—Ç–∞–∫—Ç–æ–º.
```

–ö–Ω–æ–ø–∫–∞ (ReplyKeyboard): `[üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º]`

- –ù–∞–∂–∞–ª `[üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º]` ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω –ø–æ–ª—É—á–µ–Ω ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONTACT_MANAGE** (—Å –Ω–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º)
- –í–≤—ë–ª –Ω–æ–º–µ—Ä ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è:
  - –æ–∫ ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONTACT_MANAGE** (—Å –Ω–æ–≤—ã–º –Ω–æ–º–µ—Ä–æ–º)
  - –æ—à–∏–±–∫–∞ ‚Äî ¬´–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç¬ª, –æ—Å—Ç–∞—ë–º—Å—è –≤ **ENTER_PHONE**
- `/back` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONTACT_MANAGE**
- `/cancel` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

* **CONFIRM_DELETE**

```
–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ (–ø–æ–º–µ—â–µ–Ω–∏—è, –æ—Ç–≤–µ—Ç—ã, —Ç–µ–ª–µ—Ñ–æ–Ω)
–±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –∏–∑ —Å–∏—Å—Ç–µ–º—ã. –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.
```

–ö–Ω–æ–ø–∫–∏: `[–î–∞, —É–¥–∞–ª–∏—Ç—å –≤—Å—ë]` `[–û—Ç–º–µ–Ω–∞]`

- –ù–∞–∂–∞–ª `[–î–∞, —É–¥–∞–ª–∏—Ç—å –≤—Å—ë]` ‚Äî DELETE –Ω–∞ Backend ‚Üí –±–æ—Ç: ¬´–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã¬ª ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**
- –ù–∞–∂–∞–ª `[–û—Ç–º–µ–Ω–∞]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **CONTACT_MANAGE**
- `/cancel` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

* **DONE**

```
–°–ø–∞—Å–∏–±–æ! –í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã.

–°–≤–æ–¥–∫–∞:
  –ü–æ–º–µ—â–µ–Ω–∏—è: –ö–≤–∞—Ä—Ç–∏—Ä–∞ 45, –ú–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ 12
  –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ: –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ (–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –î–æ–º)
  –®–ª–∞–≥–±–∞—É–º—ã: –ó–∞
  –¢–µ–ª–µ—Ñ–æ–Ω: +7 999 123-45-67

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å: /start
```

–ö–Ω–æ–ø–∫–∏: `[–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ]` `[–ó–∞–∫—Ä—ã—Ç—å]`

- –ù–∞–∂–∞–ª `[–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **PREMISES_OVERVIEW**
- –ù–∞–∂–∞–ª `[–ó–∞–∫—Ä—ã—Ç—å]` ‚Äî –ø–µ—Ä–µ—Ö–æ–¥ –≤ **IDLE**

---

### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –∫ CX

1. **–ö–∞–∂–¥—ã–π —à–∞–≥ ‚Äî –æ–¥–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å InlineKeyboard.** –ë–æ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —Ç–æ –∂–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (`edit_message_text`), —á–∞—Ç –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø–æ–ª–æ—Ç–Ω–æ.
2. **Share Contact** (CONTACT_MANAGE, ENTER_PHONE) ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ —à–∞–≥–∏ —Å ReplyKeyboard. –ù–∞ —ç—Ç–∏—Ö —à–∞–≥–∞—Ö `[–ù–∞–∑–∞–¥]` –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/back`.
3. **telegram_id –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∏–∑ `message.from.id` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤–∏–¥–∏—Ç —ç—Ç–æ–≥–æ.
4. **–í–æ–ø—Ä–æ—Å—ã (VOTE_METHOD, BARRIER_VOTE) –∏ —Ç–µ–ª–µ—Ñ–æ–Ω (CONTACT_MANAGE) –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–µ–∫—É—â–∏–π –æ—Ç–≤–µ—Ç** ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç, —á—Ç–æ –æ—Ç–≤–µ—á–∞–ª —Ä–∞–Ω—å—à–µ, –∏ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å.
5. **–°–æ–≥–ª–∞—Å–∏–µ —Å –ü–æ–ª–∏—Ç–∏–∫–æ–π** –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ –≤ CONTACT_MANAGE: ¬´–û—Ç–ø—Ä–∞–≤–ª—è—è –¥–∞–Ω–Ω—ã–µ, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å‚Ä¶¬ª. –ù–∞–∂–∞—Ç–∏–µ `[–°–æ—Ö—Ä–∞–Ω–∏—Ç—å]` = –∞–∫—Ç —Å–æ–≥–ª–∞—Å–∏—è.
6. **EDOM –∏ —Ñ–æ—Ä–º–∞—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã** –≤ –æ–¥–∏–Ω —à–∞–≥ VOTE_METHOD —Å —Ç—Ä–µ–º—è –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏.
7. **barrier_vote –∏ vote_format** –≤ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö —Ö—Ä–∞–Ω—è—Ç—Å—è per-contact (per-premise). –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –±–æ—Ç –¥—É–±–ª–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç—ã –≤–æ –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ –ø–æ–º–µ—â–µ–Ω–∏—è–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞.
8. **–í—Å–µ–≥–æ 13 —Å–æ—Å—Ç–æ—è–Ω–∏–π.** `/cancel` –∏–∑ –ª—é–±–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–µ–¥—ë—Ç –≤ IDLE.

---

## BOT-01 ‚Äî –ê–ª–≥–æ—Ä–∏—Ç–º—ã –ø–æ–∏—Å–∫–∞: Fuzzy Search (–õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω) –∏ Regex –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã—Ö –Ω–æ–º–µ—Ä–æ–≤

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (CoT)
–†–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –Ω–∞ Backend: –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞ (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ SR-FE03-007/CORE-01), –ø–æ–∏—Å–∫ –ø–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–º—É –Ω–æ–º–µ—Ä—É —á–µ—Ä–µ–∑ regex, –ø–∞—Ä—Å–∏–Ω–≥ —Ç–∏–ø–∞ –ø–æ–º–µ—â–µ–Ω–∏—è –∏ –Ω–æ–º–µ—Ä–∞ –ø–æ —Å–ª–æ–≤–∞—Ä—é, fuzzy matching –ø–æ –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω—É. –ü–æ–∏—Å–∫ –≤–µ–¥—ë—Ç—Å—è –≤ —Ä–∞–º–∫–∞—Ö –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –ú–ö–î (building_id –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è).

### 2. –û–ø–∏—Å–∞–Ω–∏–µ –∏ —Ü–µ–ª—å
–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–≤–æ–¥–µ: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –∏–ª–∏ ¬´—Ç–∏–ø + –Ω–æ–º–µ—Ä¬ª –ø–æ–º–µ—â–µ–Ω–∏—è —Å —É—á—ë—Ç–æ–º –æ–ø–µ—á–∞—Ç–æ–∫. –¶–µ–ª—å ‚Äî –ø–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏—è –≤ –±–æ—Ç–µ –ø–æ –ë–¢ [cite: 83, 84, 140‚Äì150, 180‚Äì181].

### 3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
* **SR-BOT01-001:** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–≤–æ–¥: –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä, —É–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤, –∑–∞–º–µ–Ω–∞ ¬´—ë¬ª –Ω–∞ ¬´–µ¬ª (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SR-FE03-007).
* **SR-BOT01-002:** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤–≤–æ–¥ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —à–∞–±–ª–æ–Ω—É –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞ (regex) –∏ –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø–æ–∏—Å–∫ –ø–æ–º–µ—â–µ–Ω–∏—è –ø–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–º—É –Ω–æ–º–µ—Ä—É –≤ –ë–î.
* **SR-BOT01-003:** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø–∞—Ä—Å–∏—Ç—å —Ç–∏–ø –ø–æ–º–µ—â–µ–Ω–∏—è (–∫–≤–∞—Ä—Ç–∏—Ä–∞, –º–∞—à–∏–Ω–æ–º–µ—Å—Ç–æ, –∫–ª–∞–¥–æ–≤–∫–∞) –∏ –Ω–æ–º–µ—Ä –ø–æ —Å–ª–æ–≤–∞—Ä—é —Å–∏–Ω–æ–Ω–∏–º–æ–≤ (–∫–≤, –∫–≤–∞—Ä—Ç–∏—Ä–∞, –º–º, –º–º–µ—Å—Ç–æ, –∫–ª–∞–¥–æ–≤–∫–∞ –∏ —Ç.–¥.).
* **SR-BOT01-004:** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–º–µ–Ω—è—Ç—å –Ω–µ—á—ë—Ç–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ (—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –õ–µ–≤–µ–Ω—à—Ç–µ–π–Ω–∞ –∏–ª–∏ –∞–Ω–∞–ª–æ–≥) –¥–ª—è —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –≤–≤–æ–¥–∞ —Å–æ —Å–ø–∏—Å–∫–æ–º –ø–æ–º–µ—â–µ–Ω–∏–π –ø—Ä–∏ –æ–ø–µ—á–∞—Ç–∫–∞—Ö.
* **SR-BOT01-005:** –°–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ª—É—á—à–∏–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è (–æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ, –º–∞–∫—Å. 5) —Å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –ø–æ–º–µ—â–µ–Ω–∏—è (premise_id) –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –±–æ—Ç–µ.
* **SR-BOT01-006:** –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π —Å–∏—Å—Ç–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —è–≤–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç ¬´–Ω–µ –Ω–∞–π–¥–µ–Ω–æ¬ª.

### 4. –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–æ—Ç–∞ –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç (¬´–∫–≤ 45¬ª, ¬´–º–º–µ—Å—Ç–æ 5¬ª).
**Main Success Scenario:**
1. –ë–æ—Ç –ø–µ—Ä–µ–¥–∞—ë—Ç —Ç–µ–∫—Å—Ç –Ω–∞ Backend (`POST /api/bot/resolve-premise`).
2. Backend –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ö–ù, –ø–∞—Ä—Å–∏—Ç —Ç–∏–ø/–Ω–æ–º–µ—Ä, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ fuzzy match.
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π; –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–±—Ä–∞—Ç—å –ø–æ–º–µ—â–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –∞–Ω–∫–µ—Ç–µ.
**Alternative Flows:**
* **AF-1 (–ù–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–π –≤–≤–æ–¥):** –í–æ–∑–≤—Ä–∞—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤; –±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç InlineKeyboard —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏.
* **AF-2 (–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥):** –í–æ–∑–≤—Ä–∞—Ç ¬´–Ω–µ –Ω–∞–π–¥–µ–Ω–æ¬ª; –±–æ—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤–≤–µ—Å—Ç–∏ —Å–Ω–æ–≤–∞ –∏–ª–∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ –∫–∞—Å–∫–∞–¥–Ω–æ–º—É –≤—ã–±–æ—Ä—É.

### 5. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–µ—Å—Ç—Ä –ø–æ–º–µ—â–µ–Ω–∏–π (CORE-01). –°–ª–æ–≤–∞—Ä—å —Å–∏–Ω–æ–Ω–∏–º–æ–≤ –¥–ª—è —Ç–∏–ø–æ–≤ ‚Äî –∫–æ–Ω—Ñ–∏–≥ (dict –≤ –∫–æ–¥–µ).

### 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ API
* **Method:** `POST /api/bot/resolve-premise` (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: `X-Bot-Token`).
* **Request:**
```json
{
  "text": "–∫–≤ 45"
}
```
* **Response:**
```json
{
  "matches": [
    { "premise_id": "77:06:...", "display": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ 45", "confidence": 1.0 }
  ]
}
```

### 7. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
* **Performance:** Fuzzy search –ø–æ –≤—Å–µ–º –ø–æ–º–µ—â–µ–Ω–∏—è–º –¥–æ–º–∞ (–æ–¥–Ω–æ–≥–æ –ú–ö–î); –ª–∏–º–∏—Ç –Ω–∞ –¥–ª–∏–Ω—É –≤–≤–æ–¥–∞ (100 —Å–∏–º–≤–æ–ª–æ–≤) –∏ –º–∞–∫—Å. 5 –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π.

---

## BOT-02 ‚Äî –ë–æ—Ç-–∞–Ω–∫–µ—Ç–∞: –ª–∏–Ω–µ–π–Ω—ã–π –¥–∏–∞–ª–æ–≥, Share Contact, —Å–æ–≥–ª–∞—Å–∏—è

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (CoT)
–†–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ Telegram-–±–æ—Ç–µ (webhook): –ø–æ—à–∞–≥–æ–≤—ã–π FSM-—Å—Ü–µ–Ω–∞—Ä–∏–π (–≤—ã–±–æ—Ä –ø–æ–º–µ—â–µ–Ω–∏—è ‚Üí —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫ ‚Üí –∫–æ–Ω—Ç–∞–∫—Ç ‚Üí –ø–æ–∑–∏—Ü–∏—è ‚Üí —Ñ–æ—Ä–º–∞—Ç ‚Üí –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–æ–º ‚Üí —Å–æ–≥–ª–∞—Å–∏—è). –î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ Backend (`POST /api/bot/submit`). Share Contact ‚Äî –∫–Ω–æ–ø–∫–∞ Telegram –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞. telegram_id –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. Email –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è.

### 2. –û–ø–∏—Å–∞–Ω–∏–µ –∏ —Ü–µ–ª—å
–õ–∏–Ω–µ–π–Ω—ã–π –æ–ø—Ä–æ—Å –≤ Telegram –¥–ª—è —Å–±–æ—Ä–∞ —Ç–µ—Ö –∂–µ –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ –∏ –≤–µ–±-—Ñ–æ—Ä–º–∞ (–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º email): –∫–æ–Ω—Ç–∞–∫—Ç, –ø–æ–∑–∏—Ü–∏—è, —Å–æ–≥–ª–∞—Å–∏—è. –¶–µ–ª—å ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–∞–Ω–∞–ª –ø–æ –ë–¢ [cite: 80, 81, 92, 93].

### 3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
* **SR-BOT02-001:** –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –≤–µ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —à–∞–≥–∞–º: –≤—ã–±–æ—Ä –ø–æ–º–µ—â–µ–Ω–∏—è (—á–µ—Ä–µ–∑ BOT-01 –∏–ª–∏ –∫–∞—Å–∫–∞–¥–Ω—ã–π –≤—ã–±–æ—Ä) ‚Üí ¬´–Ø —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫¬ª ‚Üí –∫–æ–Ω—Ç–∞–∫—Ç (—Ç–µ–ª–µ—Ñ–æ–Ω —á–µ—Ä–µ–∑ Share Contact –∏–ª–∏ –≤–≤–æ–¥ –≤—Ä—É—á–Ω—É—é) ‚Üí –ø–æ–∑–∏—Ü–∏—è –ø–æ —à–ª–∞–≥–±–∞—É–º–∞–º ‚Üí —Ñ–æ—Ä–º–∞—Ç –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è ‚Üí ¬´–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –î–æ–º¬ª ‚Üí —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –û–ü–î ‚Üí —Å–≤–æ–¥–∫–∞ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.
* **SR-BOT02-002:** –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É Share Contact (Telegram ReplyKeyboard) –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.
* **SR-BOT02-003:** –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —è–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ü–î–Ω (—Ç–µ–∫—Å—Ç + –∫–Ω–æ–ø–∫–∞ ¬´–ü—Ä–∏–Ω–∏–º–∞—é¬ª) –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º. –ü—Ä–∏ –æ—Ç–∫–∞–∑–µ ‚Äî —Å–µ—Å—Å–∏—è —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è, –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è.
* **SR-BOT02-004:** –ü–æ—Å–ª–µ —Å–±–æ—Ä–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∏—Ö –Ω–∞ Backend (`POST /api/bot/submit`) —Å `source: "telegram"` –∏ `telegram_user_id` (–∏–∑ `message.from.id`). Email –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è.
* **SR-BOT02-005:** –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ –±–æ—Ç –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å nudge –æ –¥—Ä—É–≥–∏—Ö –ø–æ–º–µ—â–µ–Ω–∏—è—Ö. –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî —Å–æ–æ–±—â–∞—Ç—å –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å.
* **SR-BOT02-006:** –ö–∞–ø—á–∞ –¥–ª—è –±–æ—Ç–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –í–º–µ—Å—Ç–æ rate limit –ø–æ IP (BE-04) –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è rate limit 10 submit/—á–∞—Å –ø–æ telegram_id.
* **SR-BOT02-007:** –ê–Ω–æ–Ω–∏–º–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –≤ –±–æ—Ç–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è; telegram_id –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.

### 4. –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ (`/start`).
**Main Success Scenario:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ–º–µ—â–µ–Ω–∏–µ, –ø–µ—Ä–µ–¥–∞—ë—Ç –∫–æ–Ω—Ç–∞–∫—Ç, –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å–æ–≥–ª–∞—Å–∏–µ.
2. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞ Backend; –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.
**Alternative Flows:**
* **AF-1 (–û—Ç–º–µ–Ω–∞ –Ω–∞ —à–∞–≥–µ):** `/cancel` –∏–ª–∏ –∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–º–µ–Ω–∞¬ª ‚Äî —Å–µ—Å—Å–∏—è —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.
* **AF-2 (–õ–∏–º–∏—Ç 10 –Ω–µ–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ –ø–æ–º–µ—â–µ–Ω–∏–µ):** Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 409; –±–æ—Ç —Å–æ–æ–±—â–∞–µ—Ç ¬´–ü–æ —ç—Ç–æ–º—É –ø–æ–º–µ—â–µ–Ω–∏—é —É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–ø–∏—Å–µ–π. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å ‚Äî /mydata¬ª.
* **AF-3 (Rate limit 10/—á–∞—Å):** Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 429; –±–æ—Ç —Å–æ–æ–±—â–∞–µ—Ç ¬´–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ—Ç–ø—Ä–∞–≤–æ–∫, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ¬ª.

### 5. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
–¢–∞ –∂–µ –º–æ–¥–µ–ª—å –∫–æ–Ω—Ç–∞–∫—Ç–∞ (FE-04). –ò–∑–º–µ–Ω–µ–Ω–∏—è:
- –ü–æ–ª–µ `source` –≤ contacts: enum `web` | `telegram` | `admin` (default `web`)
- –ü–æ–ª–µ `telegram_user_id` (bigint, nullable) ‚Äî –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ `message.from.id`
- –ú–∏–≥—Ä–∞—Ü–∏—è Alembic

### 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ API
* **Method:** `POST /api/bot/submit` (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: `X-Bot-Token`).
* **Request:**
```json
{
  "premise_id": "77:06:...",
  "is_owner": true,
  "phone": "+79991234567",
  "telegram_user_id": 123456789,
  "barrier_vote": "for",
  "vote_format": "electronic",
  "registered_in_ed": true,
  "consent_version": "1.0",
  "source": "telegram"
}
```
* **Response (—É—Å–ø–µ—Ö):** 201 Created.
* **Response (–ª–∏–º–∏—Ç –Ω–∞ –ø–æ–º–µ—â–µ–Ω–∏–µ):** 409 `{"detail": "Premise limit exceeded", "code": "PREMISE_LIMIT"}`.
* **Response (rate limit):** 429 `{"detail": "Rate limit exceeded", "retry_after": 3600}`.

### 7. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
* **Security:** `X-Bot-Token` –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏; –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ Telegram Webhook. Rate limit 10 submit/—á–∞—Å –ø–æ `telegram_user_id` (—Å—á—ë—Ç—á–∏–∫ –≤ PostgreSQL, –∞–Ω–∞–ª–æ–≥ BE-04).
* **Compliance:** –°–æ–≥–ª–∞—Å–∏—è —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Ç–æ–π –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, —á—Ç–æ –∏ –¥–ª—è –≤–µ–± (consent_version, —Ñ–ª–∞–≥).

---

## BOT-03 ‚Äî –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –≤ –±–æ—Ç–µ: —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ ¬´–ü—Ä–∞–≤–æ –Ω–∞ –∑–∞–±–≤–µ–Ω–∏–µ¬ª

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (CoT)
–†–µ–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ —Ç–æ–º –∂–µ –±–æ—Ç–µ: –∫–æ–º–∞–Ω–¥–∞ `/mydata`. Backend –Ω–∞—Ö–æ–¥–∏—Ç –∑–∞–ø–∏—Å–∏ –ø–æ Blind Index –æ—Ç telegram_user_id. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `PATCH`. –£–¥–∞–ª–µ–Ω–∏–µ ‚Äî soft delete + –∞—É–¥–∏—Ç.

### 2. –û–ø–∏—Å–∞–Ω–∏–µ –∏ —Ü–µ–ª—å
–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–æ—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ. –¶–µ–ª—å ‚Äî —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ë–¢ [cite: 92, 93] –∏ 152-–§–ó.

### 3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
* **SR-BOT03-001:** –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–∞–Ω–¥—É `/mydata` –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç.
* **SR-BOT03-002:** –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `/mydata` –±–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç Backend (`GET /api/bot/me/contacts`), –ø–µ—Ä–µ–¥–∞–≤–∞—è telegram_user_id. Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–º–µ—â–µ–Ω–∏–π –∏ –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É –ø–æ –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ (–ø–æ–º–µ—â–µ–Ω–∏–µ, –¥–∞—Ç–∞, —Å—Ç–∞—Ç—É—Å). –ü–î–Ω –≤ –æ—Ç–≤–µ—Ç–µ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è (–±–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–º–µ—â–µ–Ω–∏—è).
* **SR-BOT03-003:** –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–º–µ—â–µ–Ω–∏–π —Å InlineKeyboard: –ø–æ –∫–∞–∂–¥–æ–º—É ‚Äî –∫–Ω–æ–ø–∫–∏ ¬´–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å¬ª / ¬´–£–¥–∞–ª–∏—Ç—å¬ª.
* **SR-BOT03-004:** –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –±–æ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–µ–º –∂–µ —à–∞–≥–∞–º, —á—Ç–æ BOT-02, —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏ –æ—Ç–≤–µ—Ç–∞–º–∏; –ø–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ ‚Äî `PATCH /api/bot/me/contacts/{id}`.
* **SR-BOT03-005:** –ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –±–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ (¬´–í—ã —É–≤–µ—Ä–µ–Ω—ã? –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã¬ª). –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ ‚Äî `DELETE /api/bot/me/contacts/{id}`. Backend –≤—ã–ø–æ–ª–Ω—è–µ—Ç soft delete (–æ–±–Ω—É–ª–µ–Ω–∏–µ –ü–î–Ω, `deleted_at` = now) + –∑–∞–ø–∏—Å—å –≤ –∞—É–¥–∏—Ç.
* **SR-BOT03-006:** –ë–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è.

### 4. –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç `/mydata`.
**Main Success Scenario:**
1. –ë–æ—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–º–µ—â–µ–Ω–∏–π, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–≤–ª—è–ª –∫–æ–Ω—Ç–∞–∫—Ç.
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏–µ (—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ).
3. Backend –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –±–æ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç.
**Alternative Flows:**
* **AF-1 (–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π):** Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫; –±–æ—Ç: ¬´–í—ã –µ—â—ë –Ω–µ –∑–∞–ø–æ–ª–Ω—è–ª–∏ –∞–Ω–∫–µ—Ç—ã. –ù–∞—á–Ω–∏—Ç–µ ‚Äî /start¬ª.
* **AF-2 (–ó–∞–ø–∏—Å—å –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç):** Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403; –±–æ—Ç: ¬´–î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã¬ª.

### 5. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
**Update:** –ü–æ–ª–µ `deleted_at` (timestamp, nullable) –≤ contacts. –ü—Ä–∏ soft delete: –æ–±–Ω—É–ª–µ–Ω–∏–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π (phone, email, telegram_id_enc, how_to_address), `deleted_at` = now(). Blind Index –æ—Å—Ç–∞—ë—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞. –§–∏–ª—å—Ç—Ä `WHERE deleted_at IS NULL` –≤–æ –≤—Å–µ—Ö –≤—ã–±–æ—Ä–∫–∞—Ö.

### 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ API
* **Method:** `GET /api/bot/me/contacts?telegram_user_id={id}` ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: `X-Bot-Token`.
* **Response:**
```json
{
  "contacts": [
    { "contact_id": "uuid", "premise_display": "–ö–≤–∞—Ä—Ç–∏—Ä–∞ 45", "created_at": "...", "status": "pending" }
  ]
}
```
* **Method:** `PATCH /api/bot/me/contacts/{contact_id}` ‚Äî —Ç–µ–ª–æ —Å –æ–±–Ω–æ–≤–ª—è–µ–º—ã–º–∏ –ø–æ–ª—è–º–∏ + `telegram_user_id` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–Ω–∏—è.
* **Method:** `DELETE /api/bot/me/contacts/{contact_id}?telegram_user_id={id}` ‚Äî soft delete.

### 7. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
* **Security:** Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `telegram_user_id` –≤ –∑–∞–ø—Ä–æ—Å–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å Blind Index `telegram_id_idx` –∑–∞–ø–∏—Å–∏. –ß—É–∂–∏–µ –∑–∞–ø–∏—Å–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã.
* **Audit:** –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è (—á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ) –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ BE-03.

---

## BOT-04 ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è: –µ–¥–∏–Ω–∞—è –ë–î, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (CoT)
–ë–æ—Ç –ø–∏—à–µ—Ç —á–µ—Ä–µ–∑ Backend API ‚Üí –¥–∞–Ω–Ω—ã–µ —Å—Ä–∞–∑—É –≤ –æ–±—â–µ–π –ë–î PostgreSQL ‚Üí –≤–µ–±-–∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–≥—Ä—É–∑–∫–µ/–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π polling / WebSocket / SSE –Ω–µ —Ç—Ä–µ–±—É—é—Ç—Å—è.

### 2. –û–ø–∏—Å–∞–Ω–∏–µ –∏ —Ü–µ–ª—å
–î–∞–Ω–Ω—ã–µ –∏–∑ –±–æ—Ç–∞ –≤–∏–¥–Ω—ã –Ω–∞ —à–∞—Ö–º–∞—Ç–∫–µ, –≤ –∫–≤–æ—Ä—É–º–µ –∏ –≤ –∞–¥–º–∏–Ω–∫–µ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

### 3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
* **SR-BOT04-001:** –î–∞–Ω–Ω—ã–µ, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ/–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ/—É–¥–∞–ª—ë–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ (BOT-02, BOT-03), –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤ —Ç–æ–π –∂–µ –ë–î, —á—Ç–æ –∏ –≤–µ–±-–∞–Ω–∫–µ—Ç—ã.
* **SR-BOT04-002:** –í–µ–±-–∫–ª–∏–µ–Ω—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –≤–∫–ª—é—á–∞—è –∑–∞–ø–∏—Å–∏ –∏–∑ –±–æ—Ç–∞.
* **SR-BOT04-003:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (polling, SSE, WebSocket) –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

### 4. –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–Ω—ë—Å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞; –∞–¥–º–∏–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ.
**Main Success Scenario:**
1. –î–∞–Ω–Ω—ã–µ –∏–∑ –±–æ—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ë–î (—á–µ—Ä–µ–∑ Backend API).
2. –ê–¥–º–∏–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Üí –≤–∏–¥–∏—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ü–≤–µ—Ç–∞ –Ω–∞ —à–∞—Ö–º–∞—Ç–∫–µ, –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–≤–æ—Ä—É–º.

### 5. –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
–ù–µ –º–µ–Ω—è–µ—Ç—Å—è; –µ–¥–∏–Ω–∞—è –ë–î.

### 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ API
–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ API: —à–∞—Ö–º–∞—Ç–∫–∞ `GET /api/premises/chessboard`, –∫–≤–æ—Ä—É–º `GET /api/quorum`. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

### 7. –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
–ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è –µ–¥–∏–Ω–æ–π –ë–î.

---

## –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–æ—Ç (BOT-01 + BOT-02)

**Backend ‚Äî 2 –Ω–æ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞:**
- `POST /api/bot/resolve-premise` ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è + –ø–æ–∏—Å–∫ (–ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–∑ SR-FE03-007)
- `POST /api/bot/submit` ‚Äî —Ç–æ—Ç –∂–µ pipeline, —á—Ç–æ `/api/submit`, –Ω–æ: –±–µ–∑ captcha, rate limit –ø–æ telegram_user_id –≤–º–µ—Å—Ç–æ IP, `source: "telegram"`, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ `X-Bot-Token`

**–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `bot`:**
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞: `aiogram 3.x` (asyncio, webhook-native)
- FSM storage: SQLite (`/data/sessions.db` –Ω–∞ Docker volume `bot_data`)
- Dockerfile, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ docker-compose (volume `bot_data`)
- Nginx: location `/api/tg-wh/{secret_path}` ‚Üí bot:8443

**–ú–∏–≥—Ä–∞—Ü–∏—è Alembic:**
- –ü–æ–ª–µ `source` –≤ contacts: varchar, default `'web'`
- –ü–æ–ª–µ `telegram_user_id` (bigint, nullable)

**–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞ ‚Äî –∏–∑ SR-FE03-007. –í—ã–¥–µ–ª–∏—Ç—å –≤ `backend/app/utils/normalize.py`.
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ª–∏–º–∏—Ç—ã ‚Äî CORE-02.
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –ü–î–Ω ‚Äî BE-02.

### –§–∞–∑–∞ 2: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (BOT-03)

**Backend ‚Äî 3 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞:**
- `GET /api/bot/me/contacts` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø–æ telegram_user_id (Blind Index lookup)
- `PATCH /api/bot/me/contacts/{id}` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- `DELETE /api/bot/me/contacts/{id}` ‚Äî soft delete + –∞—É–¥–∏—Ç

**–ú–∏–≥—Ä–∞—Ü–∏—è Alembic:**
- –ü–æ–ª–µ `deleted_at` (timestamp, nullable) –≤ contacts

**–ë–æ—Ç:** –∫–æ–º–∞–Ω–¥–∞ `/mydata`, inline-–∫–Ω–æ–ø–∫–∏.

### –§–∞–∑–∞ 3: BOT-04 (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è)

–ë–µ—Å–ø–ª–∞—Ç–Ω–∞ –ø—Ä–∏ –ø–æ–¥—Ö–æ–¥–µ ¬´–±–æ—Ç ‚Üí Backend API ‚Üí –ë–î¬ª. –ò–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ –Ω–µ—Ç ‚Äî –¥–∞–Ω–Ω—ã–µ –≤–∏–¥–Ω—ã –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ.

### –û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ—ë–º–∫–æ—Å—Ç–∏

| –§–∞–∑–∞ | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—Ä–∏–º–µ—Ä–Ω–æ |
|------|-----------|----------|
| 1 | Backend: 2 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ + –º–∏–≥—Ä–∞—Ü–∏—è + rate limit –ø–æ tg_id | 2‚Äì3 –¥–Ω—è |
| 1 | Bot: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä + FSM + SQLite storage + webhook | 3‚Äì4 –¥–Ω—è |
| 1 | Infra: docker-compose + nginx + secrets | 1 –¥–µ–Ω—å |
| 2 | Backend: 3 —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ + soft delete + –º–∏–≥—Ä–∞—Ü–∏—è | 1‚Äì2 –¥–Ω—è |
| 2 | Bot: /mydata flow | 1‚Äì2 –¥–Ω—è |
| | **–ò—Ç–æ–≥–æ** | **~8‚Äì12 –¥–Ω–µ–π** |
